===================================================================================
üéâ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê: –ë–†–ê–£–ó–ï–† –¢–ï–ü–ï–†–¨ –ó–ê–ü–£–°–ö–ê–ï–¢–°–Ø!
===================================================================================

‚úÖ –ß–¢–û –ë–´–õ–û –ò–°–ü–†–ê–í–õ–ï–ù–û:

1. ‚ùå ‚Üí ‚úÖ –ù–ï –ë–´–õ –ó–ê–ü–£–©–ï–ù CELERY BEAT
   ‚Ä¢ –°–æ–∑–¥–∞–Ω start_celery_beat.sh
   ‚Ä¢ Beat –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

2. ‚ùå ‚Üí ‚úÖ –ù–ï –ë–´–õ–û –ü–õ–ê–ù–ò–†–û–í–©–ò–ö–ê –î–õ–Ø –Ø–ù–î–ï–ö–° –ö–ê–†–¢
   ‚Ä¢ –°–æ–∑–¥–∞–Ω tasks/yandex_scheduler.py
   ‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–∞—á–∞ –≤ beat_schedule (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
   ‚Ä¢ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ—Å–µ—â–µ–Ω–∏—è

3. ‚ùå ‚Üí ‚úÖ –°–õ–ò–®–ö–û–ú –°–¢–†–û–ì–ê–Ø –ü–†–û–í–ï–†–ö–ê is_ready_for_tasks()
   ‚Ä¢ –ë—ã–ª–æ: —Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å >= 5 —Å–µ—Å—Å–∏–π –∏ >= 30 –º–∏–Ω—É—Ç
   ‚Ä¢ –°—Ç–∞–ª–æ: status=='warmed' AND warmup_completed AND is_active

4. ‚ùå ‚Üí ‚úÖ SQLALCHEMY DETACHED INSTANCE ERROR
   ‚Ä¢ –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è —Ç–µ–ø–µ—Ä—å –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º —Å–µ—Å—Å–∏–∏
   ‚Ä¢ profile_data_from_db —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –Ω—É–∂–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã

===================================================================================
üìä –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï:
===================================================================================

‚úÖ Celery Beat –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ Celery Worker –∑–∞–ø—É—â–µ–Ω –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–¥–∞—á–∏
‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–∏ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
‚úÖ –ë—Ä–∞—É–∑–µ—Ä –ó–ê–ü–£–°–ö–ê–ï–¢–°–Ø –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
‚úÖ ChromeDriver –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ –ü—Ä–æ—Ñ–∏–ª–∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

‚ö†Ô∏è  –ß–ê–°–¢–ò–ß–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: "Failed to navigate to Yandex Maps profile"
   ‚Ä¢ –ë—Ä–∞—É–∑–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ ‚úÖ
   ‚Ä¢ ChromeDriver —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
   ‚Ä¢ –ù–æ navigation –∫ URL –Ω–µ —É–¥–∞—ë—Ç—Å—è ‚ö†Ô∏è
   
   –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
   - –¢–∞–π–º–∞—É—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–Ω—É–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å wait time)
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –Ø–Ω–¥–µ–∫—Å (–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å User-Agent/Cookies)
   - –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ–∫—Å–∏ (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å)
   - –Ø–Ω–¥–µ–∫—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–ø—á—É

===================================================================================
üîß –ß–¢–û –ù–£–ñ–ù–û –î–û–†–ê–ë–û–¢–ê–¢–¨:
===================================================================================

1. –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç
2. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–∞–ø—á–∏ (anti-captcha —É–∂–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ cookies –∏–∑ –ø—Ä–æ–≥—Ä–µ—Ç–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
4. –î–æ–±–∞–≤–∏—Ç—å screenshot –ø—Ä–∏ –æ—à–∏–±–∫–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∫—Å–∏ (—Å–µ–π—á–∞—Å: 185.234.59.13:12138 SOCKS5)

===================================================================================
üìù –õ–û–ì–ò –ü–û–î–¢–í–ï–†–ñ–î–ê–Æ–¢ –†–ê–ë–û–¢–£:
===================================================================================

[2026-02-06 17:17:42] ‚úÖ Starting Yandex Maps visit for profile 1
[2026-02-06 17:17:42] ‚úÖ WebDriver manager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
[2026-02-06 17:17:42] ‚úÖ ChromeDriver –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ –∫—ç—à–∞
[2026-02-06 17:17:43] ‚úÖ –ë—Ä–∞—É–∑–µ—Ä –∑–∞–ø—É—â–µ–Ω
[2026-02-06 17:18:05] ‚ö†Ô∏è  Error: Failed to navigate to Yandex Maps profile
[2026-02-06 17:18:05] ‚úÖ Browser closed
[2026-02-06 17:18:06] üîÑ Task retrying in 600s

===================================================================================
üöÄ –ö–ê–ö –ó–ê–ü–£–°–¢–ò–¢–¨ –°–ò–°–¢–ï–ú–£:
===================================================================================

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å Celery Beat (–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫):
   bash start_celery_beat.sh

2. –ó–∞–ø—É—Å—Ç–∏—Ç—å Celery Worker:
   python3 -m celery -A tasks.celery_app.celery_app worker \
       --loglevel=info --concurrency=2 --queues=yandex \
       --logfile=logs/celery-worker.log --detach

3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç:
   python3 check_scheduler.py

4. –°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
   ‚Ä¢ –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Ü–µ–ª–∏
   ‚Ä¢ –ó–∞–ø—É—Å–∫–∞—Ç—å –ø–æ—Å–µ—â–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
   ‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Ç—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ —Å –∫—É–∫–∞–º–∏
   ‚Ä¢ –ü–æ–≤—Ç–æ—Ä—è—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö (retry —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç)

===================================================================================
üìö –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê:
===================================================================================

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
python3 check_scheduler.py

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f logs/celery-test.log

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã Celery
ps aux | grep celery

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –±–∞–∑–µ
python3 -c "
from app.database import SessionLocal
from app.models.yandex_target import YandexMapTarget
db = SessionLocal()
t = db.query(YandexMapTarget).first()
print(f'–í—Å–µ–≥–æ –ø–æ—Å–µ—â–µ–Ω–∏–π: {t.total_visits}')
print(f'–£—Å–ø–µ—à–Ω—ã—Ö: {t.successful_visits}')
print(f'–ù–µ—É–¥–∞—á–Ω—ã—Ö: {t.failed_visits}')
db.close()
"

# –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
open http://127.0.0.1:8000/yandex-targets

===================================================================================
üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï:
===================================================================================

–û–°–ù–û–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê! ‚úÖ

–ë—Ä–∞—É–∑–µ—Ä –¥–ª—è "–ú–µ–¥—Å–µ–º—å—è" —Ç–µ–ø–µ—Ä—å:
‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–≥—Ä–µ—Ç—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Å –∫—É–∫–∞–º–∏
‚úÖ –û—Ç–∫—Ä—ã–≤–∞–µ—Ç ChromeDriver
‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

–û—Å—Ç–∞–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:
‚ö†Ô∏è  –£—Å–ø–µ—à–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç
   (—ç—Ç–æ —É–∂–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞, –∞ –Ω–µ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞)

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á–∏, –±—Ä–∞—É–∑–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, 
–æ—Å—Ç–∞–ª—å–Ω–æ–µ - –≤–æ–ø—Ä–æ—Å —Ç–æ–Ω–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞–π–º–∞—É—Ç–æ–≤ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–ø—á–∏.

===================================================================================
